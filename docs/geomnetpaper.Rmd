# Drawing Networks with the R package `ggplot2` 

This next section is a paper I authored with Heike Hofmann (Iowa State University) and François Briatte (European School of Political and Social Sciences) that will be published in the R Journal.  

```{r setup_knitr, echo=FALSE}
library(knitr)
opts_chunk$set(
  tidy = FALSE, echo = FALSE, cache = FALSE, eval = TRUE,
  message = FALSE, warning = FALSE, highlight = FALSE, 
  background = '#FFFFFF', dev = 'png', 
  fig.height = 8, fig.width = 8, fig.align = 'center', fig.show = 'hide'
)

## From Josh O'Brien's stackoverflow answer:
## http://stackoverflow.com/questions/11030898/knitr-how-to-align-code-and-plot-side-by-side
## These two settings control text width in codefig vs. usual code blocks
partWidth <- 35
fullWidth <- 60
options(width = fullWidth)

##  (1) CHUNK HOOK FUNCTION
##   First, to set R's textual output width on a per-chunk basis, we
## need to define a hook function which temporarily resets global R's
## option() settings, just for the current chunk
knit_hooks$set(r.opts = local({
    ropts <- NA
    function(before, options, envir) {
        if (before) {
            ropts <<- options(options$r.opts)
        } else {
            options(ropts)
        }
    }
}))

## (2) OUTPUT HOOK FUNCTION

##   Define a custom output hook function. This function processes _all_
## evaluated chunks, but will return the same output as the usual one,
## UNLESS a 'codefig' argument appeared in the chunk's header.  In that
## case, wrap the usual textual output in LaTeX code placing it in a
## narrower adjustbox environment and setting the graphics that it
## produced in another box beside it.

defaultChunkHook <- environment(knit_hooks[["get"]])$defaults$chunk

codefigChunkHook <- function(x, options) {
        main <-  defaultChunkHook(x, options)
        before <-
            "\\vspace{1em}\n
             \\begin{adjustbox}{valign=t}\n
             \\begin{minipage}{.49\\textwidth}\n"
        after <-
            paste("\\vspace{1em}\n
                   \\end{minipage}\n
                  \\begin{minipage}{.49\\textwidth}\n",
                   paste0("\\includegraphics[width=\\textwidth]{figure/",
                          options[["label"]], "-1.pdf}\n
                          \\end{minipage}\n
                          \\end{adjustbox}"),
                          sep = "\n")
    ## Was a codefig option supplied in chunk header?
    ## If so, wrap code block and graphical output with needed LaTeX code.
    if (!is.null(options$codefig)) {
      return(sprintf("%s %s %s", before, main, after))
    } else {
      return(main)
    }
}

knit_hooks[["set"]](chunk = codefigChunkHook)


## (3) TEMPLATE
##   codefig=TRUE is just one of several options needed for the
## side-by-side code block and a figure to come out right. Rather
## than typing out each of them in every single chunk header, we
## define a _template_ which bundles them all together. Then we can
## set all of those options simply by typing opts.label="codefig".

opts_template[["set"]](
codefig = list(codefig = TRUE, fig.show = "hide",
               r.opts = list(width = partWidth),
               tidy.opts = list(width.cutoff = partWidth)))
```


```{r load_packages, echo=FALSE, results='hide'}
library(dplyr)
library(tidyr)
library(ggplot2) # needs to be version ≥ 1.0.1.9003
library(scales)

## ggnet2
# if (!require(ggnet, quietly = TRUE)) {
#   devtools::install_github("briatte/ggnet")
# }
# library(ggnet)
if (!require(GGally, quietly = TRUE)) {
  devtools::install_github("ggobi/ggally")
}

## geom_net
if (!require(geomnet, quietly = TRUE)) {
  devtools::install_github("sctyner/geomnet")
}

## ggnetwork
if (!require(ggnetwork, quietly = TRUE) ||
    packageVersion("ggnetwork") < "0.2.1") {
  devtools::install_github("briatte/ggnetwork")
}

## pre-load
library(network)
library(sna)
```

There are many kinds of networks, and networks are extensively studied across many disciplines (@watts2004ars). For instance, social network analysis is a longstanding and prominent sub-field of sociology, and the study of biological networks, such as protein-protein interaction networks or metabolic networks, is a notable sub-field of biology (@prell2011social, @junker2008analysis). In addition, the ubiquity of social media platforms, like Facebook, Twitter, and LinkedIn, has brought the concepts of networks out of academia and into
the mainstream. Though these disciplines and the many others that study networks are themselves very different and specialized, they can all benefit from good network visualization tools.

Many R packages already exist to manipulate network objects, such as `statnet` by @statnet, `igraph` by @igraph, `sna` by @sna, and `network` by @network (see also @network.jss). Each one of these packages were developed with a focus of analyzing network data and not necessarily for rendering visualizations of networks. Though these packages do have network visualization capabilities, visualization was not intended as their primary purpose. This is by no means a critique or an inherently negative aspect of these packages: they are all hugely important tools for network analysis that we have relied heavily on in our own work.  We have found, however, that visualizing network data in these packages requires a lot of extra work if one is accustomed to working with more ``traditional" data structures such as vectors, data frames, or arrays. The visualization tools in these packages require detailed knowledge of each one of them and their syntax in order to build meaningful network visualizations with them. This is obviously not a problem if the user is very familiar with network structures and has already spent time working with network data. If, however, the user is new to network data or is more comfortable working with the traditional data structures, they could find the learning curve for these packages burdensome.

The packages we have written have one primary purpose: to create beautiful network visualizations by providing a wrapper to the popular `ggplot` package @ggplot2. And so, our focus here is not on adding to the analysis of network data or to the field of graph drawing, @graphdrawing but rather it is on implementing existing graph drawing capabilities in the `ggplot` framework, using the more traditional data frame structure. 

The `ggplot` package was designed as an implementation of the "grammar of graphics" proposed by @wilkinson:1999, and it has become extremely popular among R users.^[In order to give an indication of how  large the user base of  `ggplot2` is, we looked at its usage statistics from January 1, 2015 to December 31, 2015 (see [link](http://cran-logs.rstudio.com/)). Over this period, the `ggplot2` package was downloaded over 1.75 million times from CRAN, which amounts to over 6,200 downloads per day. Over 700 R packages list `ggplot2` as a dependency or as a suggestion.]

Because the syntax implemented in the `ggplot2` package is extendable to  different kinds of visualizations, many packages have built additional functionality on top of the  `ggplot2` framework. Examples include the `ggmap` package by @ggmap for spatial visualization, the `ggfortify` package by @ggfortify for visualizing statistical models, the package `ggally` by @GGally, which encompasses various complementary visualization techniques to `ggplot2`, and the `ggbio` and `ggtree` Bioconductor packages by @ggbio and @ggtree, which both provide visualizations for biological data.

These packages have expanded the utility of `ggplot2`, likely resulting in an  increase of its user base. We hope to appeal to this user base and potentially add to it by applying the benefits of the grammar of graphics implemented in `ggplot2` to network visualization. Our efforts rely upon the most recent changes to `ggplot2`, which allow users to more easily extend the package through additional geometries or `geoms`.^[Version 2.1.0, released 1 March 2016. See [](https://cran.r-project.org/web/packages/ggplot2/news.html) for the full list of changes in `ggplot2` 2.1.0, as well as the new package vignette, "Extending ggplot2"", which explains how the internal `ggproto` system of object-oriented programming can be used to create new geoms.] 